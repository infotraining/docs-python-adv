

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Testy jednostkowe &#8212; Zaawansowane programowanie w języku Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'unit-tests';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Moduły i pakiety" href="packages.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Zaawansowane programowanie w języku Python
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="classes.html">Klasy i obiekty - elementy zaawansowane</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="builtins.html">Optymalne wykorzystanie wbudowanych typów Pythona</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="builtin-types-big-o.html">Wydajność operacji na typach wbudowanych</a></li>
<li class="toctree-l2"><a class="reference internal" href="builtin-types.html">Moduł collections</a></li>




</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="functions.html">Funkcje - elementy zaawansowane</a></li>
<li class="toctree-l1"><a class="reference internal" href="iterators.html">Elementy programowania funkcyjnego</a></li>
<li class="toctree-l1"><a class="reference internal" href="decorators.html">Dekoratory funkcji i klas</a></li>
<li class="toctree-l1"><a class="reference internal" href="context-managers.html">Menadżery kontekstu</a></li>
<li class="toctree-l1"><a class="reference internal" href="pattern-matching.html">Structural Pattern Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="metaclasses.html">Metaklasy</a></li>
<li class="toctree-l1"><a class="reference internal" href="packages.html">Moduły i pakiety</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Testy jednostkowe</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/infotraining/docs-python-adv" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/infotraining/docs-python-adv/issues/new?title=Issue%20on%20page%20%2Funit-tests.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/unit-tests.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Testy jednostkowe</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#unittest">Unittest</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wprowadzenie">Wprowadzenie</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#przyklad">Przykład</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#uruchamianie-testow">Uruchamianie testów</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-i-teardown"><code class="docutils literal notranslate"><span class="pre">setUp</span></code> i <code class="docutils literal notranslate"><span class="pre">tearDown</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#self-assert"><code class="docutils literal notranslate"><span class="pre">self.assert*</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#doctest">Doctest</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pytest">Pytest</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Wprowadzenie</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#proste-testy">Proste testy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grupowanie-testow-w-klasach">Grupowanie testów w klasach</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Uruchamianie testów</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fikstury">Fikstury</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fikstury-setup-teardown">Fikstury - setup &amp; teardown</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#wbudowane-fikstury">Wbudowane fikstury</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parametryzacja-testow">Parametryzacja testów</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="testy-jednostkowe">
<h1>Testy jednostkowe<a class="headerlink" href="#testy-jednostkowe" title="Permalink to this heading">#</a></h1>
<p>Testowanie programu pozwala sprawdzić, czy program zachowuje się w pożądany sposób.
Manualne testowanie programu jest czasochłonne.
Dlatego dobrą praktyką jest pisanie automatycznych testów, które mogą zostać szybko wykonane przez komputer.
Testuje się nie tylko całe programy, ale też pojedyncze funkcje czy klasy.</p>
<p>Standardowa biblioteka Pythona posiada moduły <code class="docutils literal notranslate"><span class="pre">unittest</span></code> i <code class="docutils literal notranslate"><span class="pre">doctest</span></code> ułatwiające pisanie takich testów.</p>
<p>Alternatywą dla standardowych bibliotek jest <code class="docutils literal notranslate"><span class="pre">pytest</span></code>. Jest to jedna z najczęściej używanych bibliotek to testów jednostkowych.</p>
<section id="unittest">
<h2>Unittest<a class="headerlink" href="#unittest" title="Permalink to this heading">#</a></h2>
<section id="wprowadzenie">
<h3>Wprowadzenie<a class="headerlink" href="#wprowadzenie" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">unittest</span></code> jest jedną z najpopularniejszych bibliotek stosowanych do pisania testów jednostkowych. Wynika to jej następujących cech:</p>
<ul class="simple">
<li><p>jest częścią standardowej biblioteki Pythona, co oznacza, że jest dostępna wszędzie, gdzie jest zainstalowany Python.</p></li>
<li><p>jest inspirowana biblioteką <code class="docutils literal notranslate"><span class="pre">JUnit</span></code> z Javy. Osoby, które pisały wcześniej testy w <code class="docutils literal notranslate"><span class="pre">JUnit</span></code> bardzo szybko nauczą się pisać testy w Pythonie. Ponadto, wykorzystano sprawdzony interfejs.
Z drugiej strony, wzorowanie się na bibliotece Javy powoduje, że testy są dosyć rozwlekłe i “rozgadane”.</p></li>
<li><p>potrafi automatycznie znaleźć wszystkie testy i wykonać je.</p></li>
</ul>
</section>
<section id="przyklad">
<h3>Przykład<a class="headerlink" href="#przyklad" title="Permalink to this heading">#</a></h3>
<p>Testy grupuje się w klasach dziedziczących po <code class="docutils literal notranslate"><span class="pre">unittest.TestCase</span></code>.
Każda metoda zaczynająca się od <code class="docutils literal notranslate"><span class="pre">test_</span></code> to jeden test.
Wywołanie <code class="docutils literal notranslate"><span class="pre">unittest.main()</span></code> powoduje uruchomienie wszystkich testów (nie jest potrzebne ręczne wymienianie nazw wszystkich testów).</p>
<p>Powszechnie przyjętą konwencją jest separacja testów i testowanego kodu, poprzez umieszczenie ich w osobnych plikach.
Dodatkowo, testy umieszcza się w osobnym katalogu, a nie w tym samym katalogu co testowany moduł.
Dzięki temu możliwa jest instalacja pakietu bez instalowania bibliotek wykorzystywanych tylko przez testy.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># converters.py</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">url_converter</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Empty url&quot;</span><span class="p">)</span>

    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(http://[\w-]+(\.[\w-]+)*((/[\w-]*)?))&#39;</span>
    <span class="n">regexp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">regexp</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&lt;a href=&quot;</span><span class="se">\\</span><span class="s1">1&quot;&gt;</span><span class="se">\\</span><span class="s1">1&lt;/a&gt;&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

<span class="c1"># test_converters.py</span>
<span class="kn">import</span> <span class="nn">unittest</span>

<span class="kn">from</span> <span class="nn">converters</span> <span class="kn">import</span> <span class="n">url_converter</span>

<span class="k">class</span> <span class="nc">UrlConverterTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_converts_url_to_ahref</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://www.python.org&quot;</span>
        <span class="n">expected_ahref</span> <span class="o">=</span> <span class="s1">&#39;&lt;a href=&quot;http://www.python.org&quot;&gt;http://www.python.org&lt;/a&gt;&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">url_converter</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">expected_ahref</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>Ostatnie dwie linie powyższego kodu gwarantują uruchomienie testów, ale tylko gdy plik z kodem zostanie bezpośrednio uruchomiony, a nie zaimportowany.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>test_converters.py
</pre></div>
</div>
</section>
<section id="uruchamianie-testow">
<h3>Uruchamianie testów<a class="headerlink" href="#uruchamianie-testow" title="Permalink to this heading">#</a></h3>
<p>Możemy wykonać testy wpisując w konsoli.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>unittest<span class="w"> </span>test_my_module.TestAdd
</pre></div>
</div>
<p>Ogromną zaletą biblioteki <code class="docutils literal notranslate"><span class="pre">unittest</span></code> jest możliwość uruchomienia wszystkich testów bez określania, gdzie się one znajdują.
W takiej sytuacji biblioteka <code class="docutils literal notranslate"><span class="pre">unittest</span></code> poszukuje testów we wszystkich plikach znajdujących się w aktualnym katalogu, podkatalogach, podkatalogach podkatalogów itd.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>unittest
</pre></div>
</div>
<p>Przydatnym przełącznikiem jest <code class="docutils literal notranslate"><span class="pre">--failfast</span></code>  (lub <code class="docutils literal notranslate"><span class="pre">-f</span></code>), który zatrzymuje wykonywanie testów po pierwszym teście, który nie przeszedł.
Ułatwia to skupienie się na naprawieniu testu, ponieważ na wyjściu pojawiają się informacje dotyczące tylko jednego nieprzechodzącego testu.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>unittest<span class="w"> </span>--failfast
</pre></div>
</div>
<p>Niektóre środowiska programistyczne, takie jak PyCharm, posiadają wsparcie dla uruchamiania testów.</p>
</section>
<section id="setup-i-teardown">
<h3><code class="docutils literal notranslate"><span class="pre">setUp</span></code> i <code class="docutils literal notranslate"><span class="pre">tearDown</span></code><a class="headerlink" href="#setup-i-teardown" title="Permalink to this heading">#</a></h3>
<p>Jeżeli na początku lub na końcu każdego testu wykonujemy operacje, które powtarzają się w innych testach, wtedy można umieścić je w metodach <code class="docutils literal notranslate"><span class="pre">setUp</span></code> i <code class="docutils literal notranslate"><span class="pre">tearDown</span></code>.
<code class="docutils literal notranslate"><span class="pre">setUp</span></code> jest metodą wykonywaną na początku każdego testu, natomiast <code class="docutils literal notranslate"><span class="pre">tearDown</span></code> – po wykonaniu testu, niezależnie od tego, czy test przeszedł, czy nie.</p>
<p>Jest to świetne miejsce na:</p>
<ul class="simple">
<li><p>uzyskanie zasobów, które są potrzebne w każdym teście (np. połączenie z bazą danych),</p></li>
<li><p>skonfigurowanie środowiska w ten sam sposób dla każdego testu (np. w <code class="docutils literal notranslate"><span class="pre">setUp</span></code> – utworzenie przykładowych tabel i rekordów w bazie danych, a w <code class="docutils literal notranslate"><span class="pre">tearDown</span></code> – “posprzątanie” po teście, tzn. wyczyszczenie testowej bazy danych).</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestAdd</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;setUp&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tearDown&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_one</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;test one&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_two</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;test two&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>setUp
<span class="nb">test</span><span class="w"> </span>one
tearDown
setUp
<span class="nb">test</span><span class="w"> </span>two
tearDown
</pre></div>
</div>
<p>Warto zauważyć, że, generalnie rzecz biorąc, w Pythonie nazwy metod piszemy małymi literami, a poszczególne słowa rozdzielamy podkreślnikami, np. <code class="docutils literal notranslate"><span class="pre">tear_down</span></code>, <code class="docutils literal notranslate"><span class="pre">set_up</span></code>.
Jednak konwencja ta nie zawsze jest przestrzegana, nawet w obrębie biblioteki standardowej, czego przykładem jest <code class="docutils literal notranslate"><span class="pre">unittest</span></code>.
Jest ona wzorowana na bibliotece <code class="docutils literal notranslate"><span class="pre">JUnit</span></code> napisanej w Javie, gdzie obowiązuje konwencja “camelCase”.</p>
</section>
<section id="self-assert">
<h3><code class="docutils literal notranslate"><span class="pre">self.assert*</span></code><a class="headerlink" href="#self-assert" title="Permalink to this heading">#</a></h3>
<p>W środku każdego testu możemy wykorzystać szereg metod zaczynających się od <code class="docutils literal notranslate"><span class="pre">assert</span></code>, np. <code class="docutils literal notranslate"><span class="pre">assertEqual</span></code>.
Test przechodzi, jeżeli wszystkie takie asercje są prawdziwe.
Jeżeli chociaż jedna taka asercja nie będzie spełniona, wówczas wykonywanie testu jest natychmiast przerywane i wykonywana jest metoda <code class="docutils literal notranslate"><span class="pre">tearDown</span></code>.</p>
<p>Najczęściej wykorzystywane asercje to:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">self.assertTrue(condition)</span></code> i <code class="docutils literal notranslate"><span class="pre">self.assertFalse(condition)</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">self.assertEqual(got,</span> <span class="pre">expected)</span></code> i <code class="docutils literal notranslate"><span class="pre">self.assertNotEqual(got,</span> <span class="pre">expected)</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">self.assertIn(element,</span> <span class="pre">collection)</span></code> i <code class="docutils literal notranslate"><span class="pre">self.assertNotIn(element,</span> <span class="pre">collection)</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">self.assertIsInstance(obj,</span> <span class="pre">class_)</span></code> i <code class="docutils literal notranslate"><span class="pre">self.assertNotIsInstance(obj,</span> <span class="pre">class_)</span></code>.</p></li>
</ul>
<p>Do sprawdzenia, czy dany blok kodu rzuca wyjątek, można użyć <code class="docutils literal notranslate"><span class="pre">self.assertRaises(ExceptionType)</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UrlConverterTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_raises_exception_for_empty_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">url_converter</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
<p>Jeżeli sprawdzenie typu rzuconego wyjątku to za mało, możemy uzyskać do niego dostęp:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UrlConverterTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_raises_exception_for_empty_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">url_converter</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="s1">&#39;Empty url&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="doctest">
<h2>Doctest<a class="headerlink" href="#doctest" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">doctest</span></code> jest częścią standardowej biblioteki Pythona, ale oferuje zupełnie inne podejście do testowania.
Zamiast umieszczać testy w osobnych plikach, testy można umieścić w docstringu testowanej funkcji, klasy lub metody.
Takie podejście ma kilka przewag nad <code class="docutils literal notranslate"><span class="pre">unittest</span></code>:</p>
<ul class="simple">
<li><p>Ponieważ testy są częścią docstringa, pełnią wówczas jednocześnie rolę dokumentacji.
Jeżeli są to krótkie testy, jest to wówczas bardzo dobra dokumentacja.</p></li>
<li><p>Testy są trzymane blisko obiektu, który jest testowany, co jest generalnie pożądane, ponieważ nie ma potrzeby przeskakiwania między plikami.</p></li>
</ul>
<p>Niestety, to podejście ma też pewne istotne wady.
Przede wszystkim, takie podejście nie skaluje się wraz z coraz bardziej skomplikowanymi testami, co oznacza, że sprawdza się ono głównie w przypadku krótkich testów dla prostych funkcji.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">doctest</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the factorial of n, an exact integer &gt;= 0.</span>

<span class="sd">    &gt;&gt;&gt; factorial(3)</span>
<span class="sd">    6</span>
<span class="sd">    &gt;&gt;&gt; factorial(30)</span>
<span class="sd">    265252859812191058636308480000000</span>
<span class="sd">    &gt;&gt;&gt; factorial(-1)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">    ValueError: n must be &gt;= 0</span>
<span class="sd">    &gt;&gt;&gt; [factorial(n) for n in range(6)]</span>
<span class="sd">    [1, 1, 2, 6, 24, 120]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;n must be &gt;= 0&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">while</span> <span class="n">factor</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">*=</span> <span class="n">factor</span>
        <span class="n">factor</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="c1"># Uruchomienie testów</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="pytest">
<h2>Pytest<a class="headerlink" href="#pytest" title="Permalink to this heading">#</a></h2>
<section id="id1">
<h3>Wprowadzenie<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<p>Zasadniczą wadą biblioteki <code class="docutils literal notranslate"><span class="pre">unittest</span></code> jest rozwlekłość pisanych w nich testów.
Każdy test musi być metodą umieszczoną w klasie. Nazwy metod takie jak <code class="docutils literal notranslate"><span class="pre">self.assertEqual</span></code> są dosyć rozwlekłe.</p>
<p>Czy można pisać krótsze, czytelniejsze testy?</p>
<p>Odpowiedź brzmi tak, wystarczy doinstalować bibliotekę <code class="docutils literal notranslate"><span class="pre">pytest</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>pytest
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pytest</span></code> pozwala umieścić testy w funkcjach, których nazwa zaczyna się od <code class="docutils literal notranslate"><span class="pre">test_</span></code>.
Ponadto, można użyć asercji zamiast metod takich jak <code class="docutils literal notranslate"><span class="pre">self.assertEqual</span></code>.</p>
</section>
<section id="proste-testy">
<h3>Proste testy<a class="headerlink" href="#proste-testy" title="Permalink to this heading">#</a></h3>
<p>W bibliotece każda funkcja zaczynająca się od <code class="docutils literal notranslate"><span class="pre">test_*</span></code> jest traktowana jak test.</p>
<p>Asercje są przeprowadzane za pomocą standardowej instrukcji <code class="docutils literal notranslate"><span class="pre">assert</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># my_module.py</span>
<span class="k">def</span> <span class="nf">increment</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Zero is not valid value.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c1"># test_my_module.py</span>
<span class="kn">import</span> <span class="nn">pytest</span>

<span class="kn">from</span> <span class="nn">my_module</span> <span class="kn">import</span> <span class="n">inc</span>

<span class="k">def</span> <span class="nf">test_increment_returns_next_value</span><span class="p">():</span>
    <span class="c1"># Poniższa asercja jest znacznie czytelniejsza niż self.assertEqual(inc(3), 4)</span>
    <span class="k">assert</span> <span class="n">increment</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>
</pre></div>
</div>
<p>Asercja wyjątków jest przeprowadzana za pomocą menadżera kontekstu <code class="docutils literal notranslate"><span class="pre">pytest.raises</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_increment_raises_when_invalid_argument</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
        <span class="n">increment</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="grupowanie-testow-w-klasach">
<h3>Grupowanie testów w klasach<a class="headerlink" href="#grupowanie-testow-w-klasach" title="Permalink to this heading">#</a></h3>
<p>Testy mogą być grupowane w klasach. Klasa grupująca powinna zaczynać się od <code class="docutils literal notranslate"><span class="pre">Test*</span></code>, w przeciwnym razie testy są pomijane. Nie jest wymagane dziedziczenie po klasie bazowej, tak jak ma to miejsce w bibliotece <code class="docutils literal notranslate"><span class="pre">unittest</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestMultiple</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">test_first</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">5</span>

    <span class="k">def</span> <span class="nf">test_second</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">10</span>
</pre></div>
</div>
</section>
<section id="id2">
<h3>Uruchamianie testów<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">pytest</span></code>, podobnie jak <code class="docutils literal notranslate"><span class="pre">unittest</span></code> potrafi sam znaleźć wszystkie testy w aktualnym katalogu i podkatalogach.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pytest<span class="w"> </span>-v
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">============</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============</span>
platform<span class="w"> </span>linux<span class="w"> </span>--<span class="w"> </span>Python<span class="w"> </span><span class="m">3</span>.7.3,<span class="w"> </span>pytest-5.4.3,<span class="w"> </span>py-1.8.1,<span class="w"> </span>pluggy-0.13.1
cachedir:<span class="w"> </span>.pytest_cache
rootdir:<span class="w"> </span>/chatapp
collected<span class="w"> </span><span class="m">3</span><span class="w"> </span>items<span class="w"> </span>

test_simple.py::test_something<span class="w"> </span>FAILED<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">33</span>%<span class="o">]</span>
test_simple.py::TestMultiple::test_first<span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">66</span>%<span class="o">]</span>
test_simple.py::TestMultiple::test_second<span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>
</pre></div>
</div>
<p>Przydatną opcją jest <code class="docutils literal notranslate"><span class="pre">-k</span> <span class="pre">EXPRESSION</span></code>, która powoduje uruchamienie tylko testów, których nazwa pasuje do podanego wyrażenia tekstowego (case-insensitive):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>-k<span class="w"> </span>first

$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;not something&quot;</span>
</pre></div>
</div>
</section>
<section id="fikstury">
<h3>Fikstury<a class="headerlink" href="#fikstury" title="Permalink to this heading">#</a></h3>
<p>Dostarczanie obiektów, skonfigurowanych na potrzeby testu jest realizowane w <code class="docutils literal notranslate"><span class="pre">pytest</span></code> za pomocą funkcji z dekoratorem <code class="docutils literal notranslate"><span class="pre">&#64;pytest.fixture</span></code>. Taka funkcja może być później użyta w teście jako parametr. Powoduje to wstrzyknięcie do testu odpowiednio skonfigurowanego obiektu.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">warehouse</span><span class="p">():</span>
    <span class="n">warehouse</span> <span class="o">=</span> <span class="n">InMemoryWarehouse</span><span class="p">()</span>
    <span class="n">warehouse</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;ProductA&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">warehouse</span>

<span class="k">def</span> <span class="nf">test_order_is_filled_if_enough_items_in_warehouse</span><span class="p">(</span><span class="n">warehouse</span><span class="p">):</span>
    <span class="n">order_service</span> <span class="o">=</span> <span class="n">OrderService</span><span class="p">(</span><span class="n">warehouse</span><span class="p">)</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">order_service</span><span class="o">.</span><span class="n">process_order</span><span class="p">(</span><span class="s2">&quot;ProductA&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">order</span><span class="o">.</span><span class="n">is_filled</span><span class="p">()</span>
</pre></div>
</div>
<p>Fikstury mogą też przyjmować jako parametry inne fikstury:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="c1"># Arrange</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">first_entry</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;a&quot;</span>

<span class="c1"># Arrange</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="n">first_entry</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">first_entry</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_string</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
    <span class="c1"># Act</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>

    <span class="c1"># Assert</span>
    <span class="k">assert</span> <span class="n">order</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Możemy użyć dowolną liczbę fiktur w teście (lub innej fiksturze):</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">first_entry</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;a&quot;</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">second_entry</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">2</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="n">first_entry</span><span class="p">,</span> <span class="n">second_entry</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">first_entry</span><span class="p">,</span> <span class="n">second_entry</span><span class="p">]</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">expected_list</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">test_string</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">expected_list</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">order</span> <span class="o">==</span> <span class="n">expected_list</span>
</pre></div>
</div>
<p>Fikstura może być też implementowana jako “fabryka” (może być to potrzebne, gdy wynik fikstury jest potrzebny wiele razy w teście):</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">make_customer_record</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">_make_customer_record</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;orders&quot;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="k">return</span> <span class="n">_make_customer_record</span>


<span class="k">def</span> <span class="nf">test_customer_records</span><span class="p">(</span><span class="n">make_customer_record</span><span class="p">):</span>
    <span class="n">customer_1</span> <span class="o">=</span> <span class="n">make_customer_record</span><span class="p">(</span><span class="s2">&quot;Lisa&quot;</span><span class="p">)</span>
    <span class="n">customer_2</span> <span class="o">=</span> <span class="n">make_customer_record</span><span class="p">(</span><span class="s2">&quot;Mike&quot;</span><span class="p">)</span>
    <span class="n">customer_3</span> <span class="o">=</span> <span class="n">make_customer_record</span><span class="p">(</span><span class="s2">&quot;Meredith&quot;</span><span class="p">)</span>
</pre></div>
</div>
<section id="fikstury-setup-teardown">
<h4>Fikstury - setup &amp; teardown<a class="headerlink" href="#fikstury-setup-teardown" title="Permalink to this heading">#</a></h4>
<p>Implementacja wzorca setup &amp; teardown w <code class="docutils literal notranslate"><span class="pre">pytest</span></code> wykorzystuje generator:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">new_user</span><span class="p">(</span><span class="n">user_service</span><span class="p">):</span>
    <span class="c1"># Setup</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">user_service</span><span class="o">.</span><span class="n">create_user</span><span class="p">()</span>
    
    <span class="k">yield</span> <span class="n">user</span>
    
    <span class="c1"># Teardown</span>
    <span class="n">user_service</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_sending_email_to_new_user</span><span class="p">(</span><span class="n">new_user</span><span class="p">):</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">Email</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="s2">&quot;Greetings!&quot;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s2">&quot;Welcome&quot;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">new_user</span><span class="o">.</span><span class="n">send_email</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;OK&#39;</span>
</pre></div>
</div>
</section>
<section id="wbudowane-fikstury">
<h4>Wbudowane fikstury<a class="headerlink" href="#wbudowane-fikstury" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tmp_path</span></code> - dostarcza tymczasową ścieżkę do plików, która z każdym uruchomieniem testu jest inna</p></li>
</ul>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_tmp</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;file.txt&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FILE: &quot;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="n">f</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>

    <span class="n">fread</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;file.txt&quot;</span>
    <span class="k">assert</span> <span class="n">fread</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Hello World&quot;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>test_tmppath.py::test_tmp<span class="w"> </span>
FILE:<span class="w"> </span>/tmp/pytest-of-amol/pytest-3/test_tmp0/file.txt
PASSED
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">capsys</span></code> - pozwala odczytać tekst wypisywany w konsoli (<code class="docutils literal notranslate"><span class="pre">sys.stdout</span></code> i <code class="docutils literal notranslate"><span class="pre">sys.stderr</span></code>)</p></li>
</ul>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">myapp</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MyApp Started&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_capsys</span><span class="p">(</span><span class="n">capsys</span><span class="p">):</span>
    <span class="n">myapp</span><span class="p">()</span>

    <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">capsys</span><span class="o">.</span><span class="n">readouterr</span><span class="p">()</span>
    
    <span class="k">assert</span> <span class="n">out</span> <span class="o">==</span> <span class="s2">&quot;MyApp Started</span><span class="se">\n</span><span class="s2">&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="parametryzacja-testow">
<h3>Parametryzacja testów<a class="headerlink" href="#parametryzacja-testow" title="Permalink to this heading">#</a></h3>
<p>Dekorator <code class="docutils literal notranslate"><span class="pre">&#64;mark.paramterize</span></code> umożliwia łatwą parametryzacje testów:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;test_input,expected&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;3+5&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;2+4&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;6*9&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">test_eval</span><span class="p">(</span><span class="n">test_input</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">eval</span><span class="p">(</span><span class="n">test_input</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span>
</pre></div>
</div>
<p>Parametryzacja może być również stosowana dla całej klasy testów:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;n,expected&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)])</span>
<span class="k">class</span> <span class="nc">TestClass</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">test_simple_case</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">expected</span>

    <span class="k">def</span> <span class="nf">test_weird_simple_case</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">expected</span>
</pre></div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="packages.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Moduły i pakiety</p>
      </div>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#unittest">Unittest</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wprowadzenie">Wprowadzenie</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#przyklad">Przykład</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#uruchamianie-testow">Uruchamianie testów</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-i-teardown"><code class="docutils literal notranslate"><span class="pre">setUp</span></code> i <code class="docutils literal notranslate"><span class="pre">tearDown</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#self-assert"><code class="docutils literal notranslate"><span class="pre">self.assert*</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#doctest">Doctest</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pytest">Pytest</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Wprowadzenie</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#proste-testy">Proste testy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grupowanie-testow-w-klasach">Grupowanie testów w klasach</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Uruchamianie testów</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fikstury">Fikstury</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fikstury-setup-teardown">Fikstury - setup &amp; teardown</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#wbudowane-fikstury">Wbudowane fikstury</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parametryzacja-testow">Parametryzacja testów</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Krystian Piękoś
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>